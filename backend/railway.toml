# Railway configuration for SigmaSight Backend
# Note: railway.json is for cron jobs, this file is for the main web service
#
# DUAL DATABASE ARCHITECTURE:
# - Core DB (DATABASE_URL via gondola): portfolios, positions, market data, chat
# - AI DB (AI_DATABASE_URL via metro): RAG documents, memories, feedback with pgvector
#
# Migrations are run manually during deployment, not on every startup:
# - Core DB: alembic -c alembic.ini upgrade head
# - AI DB:   alembic -c alembic_ai.ini upgrade head

[build]
builder = "nixpacks"

[deploy]
# Start the server directly - migrations should be run manually during deployment
# To include migrations on startup, prepend:
#   alembic -c alembic.ini upgrade head && alembic -c alembic_ai.ini upgrade head &&
startCommand = "uvicorn app.main:app --host 0.0.0.0 --port $PORT"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
